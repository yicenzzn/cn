## 企业建站/小程序的高性能架构
分层是企业应用系统中最常见的一种架构模式，将系统在横向维度上切分成几个部分，每个部分负责一部分相对简单并比较单一的职责，然后通过上层对下层的依赖和调度组成一个完整的系统。

在网站的分层架构中，常见的为3层，即应用层、服务层、数据层。应用层具体负责业务和视图的展示；服务层为应用层提供服务支持；数据库提供数据存储访问服务，如数据库、缓存、文件、搜索引擎等。

分层结构对网站支持高并发向分布式方向的发展至关重要。对于不同的业务场景，产生性能瓶颈的模块也不同，有了分层逻辑的划分，就可以针对性的进行专项优化，包括：
- 可以使用公有云的负载均衡服务，实现应用层性能的水平扩展；
- 使用消息队列服务，通过服务解耦（一对多消费）、异步处理、流量削峰/缓冲等方式，降低响应时间，提高系统整体性能。
- 使用redis/memcached缓存服务、RDS数据库读写分离等，实现数据访问层的读写IO性能提升。

对于中小企业来说，可以依托云计算提供的各项中间件产品，在不增加运维复杂性的情况下，以极低的成本实现高可用、高性能的弹性伸缩架构。

### 一、负载均衡
应用负载均衡可将大并发流量分发到多台后端实例，调整资源利用情况，消除由于单台设备故障对系统的影响，提高系统可用性、扩展系统服务能力。

京东云私有网络部署：
image

**应用场景：**

**1、弹性扩容场景**

应用负载均衡后端绑定虚拟服务器组时，可使应用负载均衡将流量相对均匀的分配给多台后端服务器，绑定弹性伸缩组后可根据业务负载情况自动增加、减少后端服务器数量、以应对大流量、突发流量对系统造成的冲击，可应用于常规网站、大型业务网站、秒杀、抢购或其他可能导致突发流量增长的业务系统中。

**2、多AZ高可用场景**

应用负载均衡提供多重高可用保障机制，单实例采用集群部署（至少2个双活资源）、对后端服务器进行自动健康检查，如发现异常则不会将流量转发至该实例，直至实例运行正常后恢复；如需弹性扩容后端服务器可绑定高可用组，会根据业务负载情况自动增删后端服务器数量，高可用组会将后端服务器分布到不同的机架下，避免由于单一机架故障引起的系统故障；部分地域已支持多可用区服务，如需跨可用区高可用，可将应用负载均衡创建在不同的可用区，避免由于单一可用区故障引起的系统故障，提高系统可靠性，为客户提供更高的可用性保障。

**3、高安全性场景**

应用负载均衡可配置在内网环境，通过绑定公网IP提供对外服务，因此可隐藏内部网络结构，增强系统安全性；并且因内网部署，可通过设置安全组构建更加安全的防护体系。

### 二、消息队列

京东云消息队列（JD Cloud Message Queue，简称JCQ）是京东云自主研发的分布式消息队列服务。产品能够为不同应用之间或者不同组件之间提供可靠异步通信机制，并且实现了消息的发布订阅、消息查询、死信队列、重置消费点位、事务消息、顺序消息、分区顺序消息和延时消息等功能，具有高可用、高可靠、高性能、平滑扩容和动态监控等特性，是云架构中不可或缺的核心产品。

Producer：消息生产者，负责生产和发送消息到Broker；

Broker：消息处理中心，负责消息存储、确认、重试等；包含多个Queue；

Consumer：消息消费者，负责从Broker中获取消息，并进行相应处理；

**应用场景：**

**1、系统解耦**

在企业复杂的多业务系统中，很多业务流程不强依赖于核心流程，可以放到消息队列中让消息消费者去按需消费，而不影响核心主流程。 场景：电商场景 上游业务交易系统完成后，将消息存储到消息队列中，下游业务系统物流、购物车、积分等等从消息队列中消费，相互隔离，并行处理，能保证分布式系统之间的最终一致。

**2、信息异步可靠传递**

对于上游系统发出的请求，接收者可能响应时间较长，并且由于网络，断电，负载过高等各种原因无法接受，而消息队列同步写入、三副本备份可以存储请求，保证消息的异步可靠传递，保证请求的时效性和可靠性。 场景：资金转移 当大量交易产生时，真正交易系统可能还未进行账户数值的变动，但交易操作记录会被持久化保存，允许系统异步处理，直到成功完成。

**3、削峰填谷**

上下游系统处理能力存在差距的时候，利用消息队列作为数据的缓冲器，控制信息流量，在下游有能力处理的时候，再进行消费，避免请求无效，无服务能力。 场景：秒杀抢购 用户在页面进行秒杀，前端页面即刻响应，将请求发给消息队列 JCQ, 订单或者确认稍后反馈给用户，客户便可关闭网页进行其他活动。

### 三、缓存

京东云缓存Redis（JCS for Redis），是京东云打造的兼容开源 Redis 协议标准的高性能在线缓存服务，及时响应您海量用户的高并发访问需求。支持双机热备，提供自动容灾切换、数据备份、在线平滑扩缩容、实例监控等完善的缓存服务。历经数次京东大促考验，满足您的在线数据业务对高性能、高弹性、高可靠的需求。

云缓存Redis目前支持三种架构类型：标准版、Proxy集群版、Cluster集群版，均为默认双副本架构。对于中小企业来说，初期可选择标准版实例，适用于对Redis协议兼容性要求较高，性能压力可控的业务场景。

image

| 标准版 | 基本信息 |
|  ----  | ----  |
| 兼容版本 | Redis 2.8、Redis 4.0、Redis 5.0 |
| 副本数 | 共2副本，包含1主节点、1从节点，数据通过实时复制保持一致。|
| 实例规格 | 实例规格可支持1G-64G ；支持多DB，用户可自定义16-256个DB数量。 |
| 可用性 | 通过HA高可用机制，当主节点故障后，系统将会自动在30秒内进行主从切换，恢复后主从关系分布跟用户创建时保持一致。 |
| 可靠性 | 支持从副本持久化；支持手动/自动定期进行数据备份；支持通过从备份文件恢复。 |
| 变配 | 支持容量扩缩容。如需更大规格或者更高QPS，可支持变配为集群版架构。 |
| 客户端协议 | 传统Redis客户端即可。 |


