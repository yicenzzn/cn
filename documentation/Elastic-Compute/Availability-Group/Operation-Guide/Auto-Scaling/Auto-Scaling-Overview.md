# 自动伸缩概述

高可用组开启自动伸缩后，可设置基于系统监控指标（如CPU、内存利用率）或自定义监控配置的告警策略以及预先设置时间，到预设时间后自动伸缩的定时策略来进行实例数量的增减，以应对业务负载波动情况。对于自动伸缩您需要了解以下概念。

## 伸缩范围
伸缩范围指为高可用组开启自动伸缩后，组内实例的最小和最大数量，所有策略触发的伸缩活动都在此范围内调整实例数量。

## 定时策略
定时策略指通过设置定时任务在指定时间触发伸缩规则，实现高可用组内实例的增删。

## 告警策略
告警策略是利用云监控系统监控或自定义监控动态管理高可用组内实例的方式，通过监控指标的告警任务来触发您指定的伸缩规则，进而达到自动调整组内实例数量的目的。
* 系统监控：指云主机系统上报的相关监控指标，目前仅支持CPU使用率、内存使用率、网络入速率、网络出速率。
* 自定义监控：指您通过云监控OpenAPI上报至自定义监控的监控指标，由于自定义监控跟云上资源并无强关联关系，因此如需要基于此类指标的告警触发高可用组调整需要确保上报指标的维度中包含高可用组ID。
## 移除策略

当告警策略/定时策略触发移除高可用组内实例时，会按照自动伸缩配置的移除策略决定移除哪些是里。您可从以下三种移出策略中选择：

* 默认策略：将按照均匀部署的原则，将移除实例数最多的可用区内对应实例数最多的故障域内实例，若有多台实例满足要求，则随机选择。
* 移除最早创建：移除最早创建的实例。
* 移除最晚创建：移除最晚创建的实例，即最新的实例。

		请注意，移除策略只对自动移除生效，对于自动移除而言将只移除按配置计费实例，即若满足条件的为包年包月实例，则按照要求继续寻找满足要求的实例，直至满足的为按配置计费实例。此外自动移除实例的同时将自动删除该实例。

## 冷却时间

高可用组自动伸缩功能有两个冷却时间时间概念，一个是每一条告警策略所设置的冷却时间，一个是自动伸缩默认冷却时间（生效于定时伸缩策略，默认值为300s，暂不支持修改），可以确保在上一次伸缩活动真正生效前自动伸缩不会新增或移除其他实例。手动新增或移除高可用组内实例则不受冷却时间限制。

高可用组新增实例后，由于实例创建以及应用自启动配置需要一段时间，完成后能分担业务负载。如果没有冷却时间，同时告警伸缩策略监控周期或重复周期配置值较小，会导致负载降低前不断出发自动新增实例，而第一次新增的实例接管业务后，发现负载过低，然后又会触发缩容。

例如，业务出现流量高峰，导致告警策略的警报触发。该警报触发时，高可用组自动伸缩会新增一台实例来帮助处理增加的业务。但是存在一个问题：该实例需要几分钟的时间才能创建完成，并且启动后需要时间配置服务并逐渐从负载均衡接收请求。在此期间，告警策略可能会继续触发，从而导致一直在新增实例。但若您设置了冷却时间，在新增一台实例后，高可用组自动伸缩将处于冷却中，所有自动伸缩活动将暂停，直至经过了对应的时间（假设为 300s）。这样新创建的实例有时间开始处理应用程序流量。冷却时间过后，如果告警策略再次触发，则高可用组将自动新增一台实例，而冷却时间也会再次生效。
