# 使用云缓存


## 连接/登录

**Q：创建实例耗时多久？**

A：正常情况下实例规格越大、分片数越多，都会导致创建时间越长。例如，创建 64G 以下规格大约5分钟左右，128G 集群版大约15分钟左右。

**Q：缓存Redis支持外网访问吗？**

A：为提升数据访问的安全性，缓存Redis目前仅支持内网云主机访问。可以设置公网代理访问，详情见：[公网连接Redis实例](https://docs.jdcloud.com/cn/jcs-for-redis/connectinstance)  。

**Q：云主机为何访问不了Redis实例？**

A：建议您可进行如下检查：

1.首先确认该云主机和Redis在同一个VPC中；

2.如是同一VPC内，请按 [使用redis-cli连接Redis](https://docs.jdcloud.com/cn/jcs-for-redis/tool-redis-cli)  文档检查格式和内容是否正确；

3.是否开启了Redis白名单功能。

4.如果仍连接不了，请联系客服寻求帮助。

**Q：如果某个Redis分片出现异常，会对客户端有什么影响**

A：Redis分片采用主从高可用架构，在master节点发生故障时，管理节点会自动进行主从切换，保证服务的高可用。同时会新建一个Redis节点，恢复Redis分片的高可用架构。

**Q：为什么有的链接存在过一段时间后连接不上**

A：多数情况由于redis服务端默认有5分钟空闲连接断开机制，所以不建议程序端发起超过5分钟以上的空闲长连接。可在“参数配置”中，修改timeout参数。

**Q：如何获取Redis实例的IP?**

A：目前describeCacheInstance接口无法获取到redis访问域名后的IP地址，可以通过ping redis域名获得。注意redis实例如果做了配置变更，域名后解析的IP就会变。



## 缓存分析与性能

**Q：内存目前88%，max_memory达到多少会出触发淘汰策略。**

A：内存100%会触发淘汰。

**Q：通过参数配置设置了缓存淘汰策略allkeys-lru，实例是否需要重启？**

A：不用重启服务。

**Q：看监控时发现 master0 和shard0 cpu 正常不高，slave cpu高，这是什么原因？**

A：slave要做aof rewrite操作，高是很正常的。

**Q：如何下载和查看慢日志？**

A：标准命令行为 ： 

    wget -O /tmp/dump.aof url 
    
    

在云主机上执行命令： 

    wget -o “保存文件的绝对路径.aof“   '下载的URL'
    
    

然后直接vim相关文件就可以查看到相关日志信息。


## 命令使用

**Q：针对云缓存Redis的命令支持文档中提到Server（服务器）是支持FLUSHALL，不受版本限制。事务中是不支持FLUSHALL。但用户侧在 WebCli 中执行flushall为什么会报错？**

A：WebCli 禁用了一部分支持的命令，比如：flushall、keys、pub/sub、multi/exec等。如果用户需要使用这些命令，可以创建一个云主机，然后通过redis-cli或者其他redis客户端工具执行。

**Q：是否支持布隆过滤器**

A：当前云缓存Redis不支持。

**Q：云缓存Redis 4.0 版本中，使用rename命令时为何报错？**

A：实例是分片集群，对于分片集群，重命名的key需要保证在一个分片上。rename这个命令比较特殊，实际上是分2步：先新建一个key，再删除老key，所以必须要保证在一个分片上。


## 备份恢复

**Q：恢复数据时发现数据恢复按钮是置灰的。怎么解决？**

A：有几种可能情况：备份失败、备份中、变配中、欠费。请先排查，如还有问题可联系客服。


## 变配扩缩容

**Q：变配会对业务产生多少影响。**

A：会存在下述影响：部分连接被重置，重试即可恢复；每个分片都有秒级只读时间，不能写数据；变配过程中会占用一定ip资源，用户需要预留足够ip，变配完成后这些被占用的资源将会释放。综上，建议在业务低峰期处理变配操作。

**Q：升降配有何性能影响。**

A：云缓存Redis本身支持平滑水平、垂直扩缩容。升降配过程中，Redis性能可能会下降，会有短暂的只读状态出现但不影响写入，很快会恢复， 建议在业务低峰期处理。


